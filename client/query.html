<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据管理系统</title>
    <!-- 网页图标 -->
    <link rel="icon" type="image/png" href="../../icon/icons-database.png">
    <!-- 加载前检查用户是否登录 -->
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const username = localStorage.getItem('username'); // 模拟获取用户名
            if (!username) {
                window.location.href = '../login.html'; // 如果未登录，重定向到登录页面
            } else {
                document.getElementById('username-button').textContent = username; // 显示用户名
            }
        });
    </script>
    <!-- 验证token -->
    <script src='../../javaScript/verifyToken.js'></script>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <!-- 引入SheetJS库 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>


    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#99774b',
                        secondary: '#f9f8f6',
                        neutral: '#F2F3F5',
                        'neutral-dark': '#4E5969',
                        success: '#00B42A',
                        warning: '#FF7D00',
                        danger: '#F53F3F',
                        info: '#86909C'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>

    <!-- 自定义工具类 -->
    <link rel="stylesheet" href="../../style.css">

    <style>

        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* 表格行悬停效果 */
        .table-row-hover {
            transition: background-color 0.2s ease;
        }

        .table-row-hover:hover {
            background-color: rgba(22, 93, 255, 0.05);
        }

        /* 卡片阴影效果 */
        .card-shadow {
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }

        .card-shadow:hover {
            box-shadow: 0 8px 24px rgba(22, 93, 255, 0.12);
            transform: translateY(-2px);

        }

        span {
            white-space: normal;
            /* 允许换行 */
            word-wrap: break-word;
            /* 允许单词换行 */
        }
    </style>
    <style type="text/tailwindcss">
        /* 表格备注 */
        @layer utilities {
            .tooltip {
                @apply invisible absolute bg-neutral text-black text-sm rounded py-1 px-2 shadow-lg z-50 transition-opacity duration-200 opacity-0;
            }

            .has-tooltip:hover .tooltip {
                @apply visible opacity-100;
            }

            .table-hover-row tr:hover {
                @apply bg-gray-500;
            }

            /* 勾选框 */
            .checkbox-primary:checked {
                background-color: #99774b ;
                border-color: #000000 ;
            }
        }
    </style>
</head>

<body class="bg-gray-50 font-inter text-gray-800 min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="bg-primary text-white p-2 rounded-lg">
                    <i class="fa fa-search text-xl"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-800">数据管理系统</h1>
                <div class="hidden md:flex items-center space-x-6"></div>
                <div class="hidden md:flex items-center space-x-6">
                    <button onClick="javascript:history.back(-1);"
                        class="flex items-center bg-gray-100 hover:bg-primary text-black font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <i class="fa fa-arrow-left text-gray-600 text-2xl transition-colors"></i>
                        <span
                            class="hidden md:inline-block text-xl text-gray-800 transition-colors">返回</span>
                    </button>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <div class="hidden md:flex items-center space-x-6">
                    <button id="user-button"
                        class="flex items-center bg-gray-200 hover:bg-primary text-black font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                            <i id="user-icon" class="fa fa-user text-gray-600 "></i>
                        </div>
                        <span id="username-button" class="text-sm font-medium hidden md:inline-block ml-2">用户名</span>
                    </button>
                    <button
                        class="flex items-center bg-gray-200 hover:bg-primary text-black font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                            <i class="fa fa-envelope"></i>
                        </div>
                        <span class="text-sm font-medium hidden md:inline-block ml-2">消息</span>
                        <span
                            class="hidden ml-2 bg-gray-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- 粒子效果容器 -->
        <div id="particles-js"></div>
        <!-- 引入粒子效果配置 -->
        <script src="https://cdn.jsdelivr.net/gh/VincentGarreau/particles.js@2.0.0/particles.min.js"></script>

        <!-- 页面标题和统计 -->
        <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">测试数据列表</h2>
                <p class="text-gray-500 mt-1">共 <span id="total-records" class="font-medium text-primary">0</span> 条记录
                </p>
            </div>
        </div>

        <!-- 筛选框区域 -->
        <div class="bg-white/70 transition-all rounded-2xl p-6 shadow-lg hover:shadow-2xl shadow-primary/10 mb-4">
            <div id="filter-drawer" class="rounded-2xl p-4 border border-gray-100 hover:bg-primary/20 hover:border-gray-300 cursor-pointer">
                <div class="flex items-center justify-center">
                    <h2 class="font-semibold text-lg text-gray-700">设置筛选条件</h2>
                    <div class="hover:text-primary ml-2">
                        <i id='filter-drawer-icon' class="fa fa-eye-slash ml-1"></i>
                    </div>
                </div>
                <div class="flex items-center justify-center">
                    (<span id="filter-condition">无</span>)
                </div>
            </div>

            <div id="condition-term" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-2">
                <div data-column="器械类别">
                    <label class="block text-sm font-medium text-gray-700 mb-1">器械类别<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <div class="grid grid-cols-1 md:grid-cols-3 space-x-2"> 
                        <select id="dataGroup"
                            class="col-span-3 w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                            <option value="">全部</option>
                            <option value="种植体">种植体</option>
                            <option value="基台">基台</option>
                            <option value="支抗钉">支抗钉</option>
                            <option value="钻类">钻类</option>
                            <option value="植入器">植入器</option>
                            <option value="旋转器械">旋转器械(延长杆、螺丝刀等)</option>
                            <option value="牙科材料">牙科材料</option>
                            <option value="其他">其他</option>
                        </select>
                        <input type="text" id="other-dataGroup"
                            class="hidden col-span-2 w-full p-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200" >
                    </div>
                </div>
                <div data-column="测试类型">
                    <label class="block text-sm font-medium text-gray-700 mb-1">测试类型<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <select id="testType"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                        <option value="">全部</option>
                        <option value="标准疲劳">标准疲劳</option>
                        <option value="拉伸强度">拉伸强度</option>
                        <option value="抗扭强度">抗扭强度</option>
                        <option value="抗压强度">抗压强度</option>
                        <option value="切削性能">切削性能</option>
                        <option value="表面粗糙度">表面粗糙度</option>
                        <option value="耐腐蚀性">耐腐蚀性</option>
                        <option value="旋入性能">旋入性能</option>
                        <option value="拔出性能">拔出性能</option>
                        <option value="硬度">硬度</option>
                        <option value="其他">其他</option>
                    </select>
                </div>

                <div data-column="测试标准">
                    <label class="block text-sm font-medium text-gray-700 mb-1">测试标准<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <select id="testStandard"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                        <option value="">全部</option>
                        <option value="YY/T 0521">YY/T 0521:种植体动态疲劳试验</option>
                        <option value="YY 0315">YY 0315:钛及钛合金牙种植体</option>
                        <option value="GB/T 16886">GB/T 16886:医疗器械生物学评价</option>
                        <option value="YY/T 0874"> YY/T 0874:旋转器械实验方法</option>
                        <option value="ISO TS 13498">ISO TS 13498:连接部分接头扭力试验</option>
                        <option value="YY/T 1506">【YY/T 1506】:金属接骨螺钉旋动扭矩测试方法</option>
                        <option value="YY/T 0662">【YY/T 0662】:金属接骨螺钉机械性能要求和测试方法</option>
                        <option value="3mm皮质自攻旋入">【支抗钉】3mm皮质自攻旋入</option>
                        <option value="5mm松质80N压力旋入">【支抗钉】5mm松质80N压力旋入</option>
                        <option value="其他">其他</option>
                    </select>
                </div>

                <div data-column="器械型号">
                    <label class="block text-sm font-medium text-gray-700 mb-1">器械型号<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <input type="text" id="testModel"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                        placeholder="输入型号">
                </div>

                <div data-column="规格">
                    <label class="block text-sm font-medium text-gray-700 mb-1">规格<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <input type="text" id="testSpecification"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                        placeholder="输入规格">
                </div>

                <div data-column="批次/阶段">
                    <label for="testBatch" class="block text-sm font-medium text-gray-700 mb-2">批次/阶段<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <select id="testBatch"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                        <option value="">全部</option>
                        <option value="研发试制">研发试制</option>
                        <option value="生产试制">生产试制</option>
                        <option value="上市产品">上市产品</option>
                    </select>
                </div>

                <div data-column="材料">
                    <label class="block text-sm font-medium text-gray-700 mb-1">材料<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <select id="material"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                        <option value="">全部</option>
                        <option value="Grade4(冷轧)">Grade 4:纯钛(材料供应商:Zapp)</option>
                        <option value="Grade 4A">Grade 4A:纯钛(未知材料供应商)</option>
                        <option value="TC4">TC4(Ti-6Al-4V):钛合金</option>
                        <option value="TC4-ELI">TC4 ELI(Ti-6Al-4V ELI):钛合金</option>
                        <option value="S45500">S45500:不锈钢</option>
                        <option value="S46500">S46500:不锈钢</option>
                        <option value="1RK91">1RK91:不锈钢</option>
                        <option value="其他">其他</option>
                    </select>
                </div>

                <div data-column="测试人">
                    <label class="block text-sm font-medium text-gray-700 mb-1">测试人<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <input type="text" id="testMember"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                        placeholder="输入测试人">
                </div>

                <div data-column="测试时间">
                    <label class="block text-sm font-medium text-gray-700 mb-1">测试时间范围<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <div class="flex space-x-2">
                        <input type="date" id="startTime"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                        <p>~</p>
                        <input type="date" id="endTime"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                    </div>
                </div>

                <div data-column="结果">
                    <label class="block text-sm font-medium text-gray-700 mb-1">结果状态<i class="fa fa-eye-slash hidden ml-3"></i></label>
                    <select id="resultStatus"
                        class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                        <option value="">全部</option>
                        <option value="通过">通过</option>
                        <option value="未通过">未通过</option>
                        <option value="待确认">待确认</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
            </div>

            <div id="condition-btns" class="hidden mt-5 flex justify-end space-x-3">
                <button id="btn-clear-filter"
                    class="px-5 py-2 bg-white border border-gray-400 rounded-lg shadow-sm hover:bg-gray-50 transition-colors">
                    取消
                </button>
                <button id="reset-filters" class="px-2 py-2 bg-white border border-gray-400 rounded-lg shadow-sm hover:bg-gray-50 transition-colors">
                    <i class="fa fa-refresh mr-1"></i> 重置条件
                </button>
                <button id="btn-apply-filter"
                    class="px-5 py-2 bg-primary text-white rounded-lg shadow-sm hover:bg-primary/90 transition-colors">
                    <i class="fa fa-filter mr-2"></i> 应用筛选
                </button>
            </div>
        </div>

        <!-- 数据表格 -->
        <div class="bg-white rounded-xl shadow-soft overflow-hidden mb-4" id="sortableTable">
            <div class="rounded-1xl p-4 shadow-lg hover:bg-primary/20 cursor-pointer">
                <div id="column-toggle-btn" class="flex items-center justify-center">
                    <h2 class="font-semibold text-xl text-gray-700">实验数据筛选表</h2>
                    <div class="hover:text-primary ml-2">
                        <i id='column-toggle-icon' class="fa fa-chevron-down ml-1"></i>
                        <!-- 复选框将通过JavaScript动态生成 -->
                    </div>
                </div>
                <div id="column-toggle-container" class="flex items-center justify-center ml-2 hidden"></div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-300 mb-4">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="序号">
                                序号<i class="fa fa-sort ml-1" hidden></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="器械类别">
                                器械类别<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="测试类型">
                                测试类型<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="测试标准">
                                测试标准<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="器械型号">
                                器械型号<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="规格">
                                规格<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="批次/阶段">
                                批次/阶段<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="材料">
                                材料<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="测试人">
                                测试人<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="测试时间">
                                测试时间<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="sortable-header px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="结果">
                                结果<i class="fa fa-sort ml-1"></i>
                            </th>
                            <th scope="col"
                                class="px-6 py-3 text-middle text-xs font-medium text-gray-500 uppercase tracking-wider" data-column="操作">
                                操作
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="test-data-body">
                        <!-- 数据行将通过JavaScript动态添加 -->
                    </tbody>
                </table>
            </div>

            <!-- 分页控件 -->
            <div class="px-6 py-4 flex items-center justify-between border-t border-gray-200">
                <div class="flex-1 flex justify-between">
                    <div class="justify-center">
                        <span class="text-sm text-gray-700">
                            每页显示<input type="numer" id="show-items-num" value=15
                            class="w-10 p-1 font-medium text-center border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"> 条
                        </span>
                        <p class="text-sm text-gray-700">
                            显示第 <span id="start-index" class="font-medium">1</span> 至 <span id="end-index"
                                class="font-medium">10</span> 条，共 <span id="total-items" class="font-medium"
                                id="pagination-total">0</span> 条记录（其中<span id="notpass-items" class="font-medium"
                                id="pagination-total">0</span>条未录入，仅自己/管理员可见）
                        </p>
                    </div>
                </div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <button
                        class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                        id="prev-btn">
                        <i class="fa fa-chevron-left text-xs"></i><span class="px-2"> 上一页</span>
                    </button>
                    <div id="pagination-numbers" class="flex space-x-1">
                        <!-- 分页按钮将通过JavaScript动态插入 -->
                    </div>
                    <!-- <button aria-current="page"
                        class="z-10 bg-primary text-white relative inline-flex items-center px-4 py-2 border border-primary text-sm font-medium">
                        1
                    </button>-->
                    <button
                        class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                        id="next-btn">
                        <span class="px-2">下一页</span><i class="fa fa-chevron-right text-xs"></i>
                    </button>
                </nav>
            </div>
            <!-- 导出按钮 -->
            <div class="mt-4 md:mt-0 flex space-x-3 mb-2 ml-auto justify-between px-6 py-2">
                <div class="flex">
                    <span class="text-sm text-gray-700">
                        注：录入完成后，无法通过前端修改；如有数据变更等问题，请联系开发者。
                    </span>
                </div>
                <button id="export-btn"
                    class="px-4 py-2 bg-primary text-white rounded-lg shadow-sm hover:bg-primary/90 transition-colors flex items-center">
                    <i class="fa fa-download mr-2"></i>
                    <span>导出结果</span>
                </button>
            </div>
        </div>
        <!-- 悬浮AI按钮 -->
        <button class="ai-content-button" id="deepseek-button" title="AI助手">
            <img class="h-[1.85rem] mx-auto block" src="../../icon/deepseek.png">
        </button>
        <!-- 悬浮按钮 -->
        <button class="floating-button r-50" id="add-data-button">
            <i class="fa fa-plus"></i>
        </button>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white sticky bottom-0 z-50 border-t border-gray-200 py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">© 2024 莱顿-力学测试数据库</span>
                    <span
                        class="bg-primary/10 text-primary text-xs px-2 py-1 rounded-full border border-primary/30 cursor-pointer">
                        <i class="fa fa-flask mr-1"></i>
                        <span id="version-span">
                        </span>
                    </span>
                </div>
                <div class="flex space-x-4">
                    <button id="yuanbao-btn" class="flex hover:border hover:border-primary" title="腾讯元宝">
                        <img class="h-[1.65rem] mx-auto block" src="../../icon/logo_yuanbao.png">
                        <span class="ml-1">腾讯元宝</span>
                    </button>
                    <button id="naton-btn" class="flex hover:border hover:border-primary" title="智慧办公">
                        <img class="h-[1.5rem] mx-auto block" src="../../icon/logo_naton.png">
                        <span class="ml-1">智慧办公</span>
                    </button>
                    <a class="text-gray-500 hover:text-primary transition-colors cursor-pointer" id="guide-a">
                        <i class="fa fa-question-circle"></i>
                        <span class="ml-1">操作指引</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 详情模态框 -->
    <div id="detail-modal"
        class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 transform scale-95 transition-transform duration-300 max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                <h3 class="text-2xl font-bold text-gray-800" id="modal-title">测试详情</h3>
                <button id="close-detail-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div id="modal-content" class="flex-grow overflow-y-auto p-6">
            </div>
        </div>
    </div>

    <!-- 添加数据模态框 -->
    <div id="add-data-modal"
        class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 transform scale-95 transition-transform duration-300 max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                <h3 class="text-2xl font-bold text-gray-800" id="data-modal-title">添加测试数据</h3>
                <button id="close-data-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div id="uploader-modal" class="hidden bg-white rounded-xl shadow-xl text-lg max-w-4xl w-full mx-4 transform scale-95 md-1">
                提交人：<span id="uploader-span" class="text-highlight"></span>
            </div>
            <!-- TODO:添加数据 -->
            <div class="overflow-y-auto">
                <div id="data-content"
                    class="grid grid-cols-3 border border-gray-300 space-x-2 space-y-2 flex-grow p-6">
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">器械类别<span class="text-red-600">
                                *</span></label>
                        <div class="grid grid-cols-1 md:grid-cols-3 space-x-2">
                            <select id="dataGroup-modal"
                                class="col-span-3 w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                                <option value="">请选择</option>
                                <option value="种植体">种植体</option>
                                <option value="基台">基台</option>
                                <option value="支抗钉">支抗钉</option>
                                <option value="钻类">钻类</option>
                                <option value="植入器">植入器</option>
                                <option value="旋转器械">旋转器械(延长杆、螺丝刀等)</option>
                                <option value="牙科材料">牙科材料</option>
                                <option value="其他">其他</option>
                            </select>
                            <div id="dataGroupOther-modal" class="col-span-2 item-center mt-1 hidden">
                                <input type="text" id="otherGroup-input" 
                                    class="w-full p-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200"
                                    placeholder="请输入其他器械类别">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">测试类型</label>
                        <select id="testType-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                            <option value="">请选择</option>
                            <option value="标准疲劳">标准疲劳</option>
                            <option value="拉伸强度">拉伸强度</option>
                            <option value="抗扭强度">抗扭强度</option>
                            <option value="抗压强度">抗压强度</option>
                            <option value="切削性能">切削性能</option>
                            <option value="表面粗糙度">表面粗糙度</option>
                            <option value="耐腐蚀性">耐腐蚀性</option>
                            <option value="旋入性能">旋入性能</option>
                            <option value="拔出性能">拔出性能</option>
                            <option value="硬度">硬度</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">测试标准</label>
                        <select id="testStandard-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                            <option value="">请选择</option>
                            <option value="YY/T 0521">YY/T 0521:种植体动态疲劳试验</option>
                            <option value="YY 0315">YY 0315:钛及钛合金牙种植体</option>
                            <option value="GB/T 16886">GB/T 16886:医疗器械生物学评价</option>
                            <option value="YY/T 0874"> YY/T 0874:旋转器械实验方法</option>
                            <option value="ISO TS 13498">ISO TS 13498:连接部分接头扭力试验</option>
                            <option value="YY/T 1506">【YY/T 1506】:金属接骨螺钉旋动扭矩测试方法</option>
                            <option value="YY/T 0662">【YY/T 0662】:金属接骨螺钉机械性能要求和测试方法</option>
                            <option value="3mm皮质自攻旋入">【支抗钉】3mm皮质自攻旋入</option>
                            <option value="5mm松质80N压力旋入">【支抗钉】5mm松质80N压力旋入</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">器械型号</label>
                        <input type="text" id="testModel-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                            placeholder="输入型号">
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">规格</label>
                        <input type="text" id="testSpecification-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                            placeholder="输入规格">
                    </div>
                    <div>
                        <label for="testBatch" class="block text-lg font-medium text-gray-700 mb-2">批次/阶段</label>
                        <select id="testBatch-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                            <option value="">请选择</option>
                            <option value="研发试制">研发试制</option>
                            <option value="生产试制">生产试制</option>
                            <option value="上市产品">上市产品</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">批次备注</label>
                        <input type="text" id="testBatchTooltip-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                            placeholder="输入批次备注信息">
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">材料</label>
                        <select id="material-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                            <option value="">请选择</option>
                            <option value="Grade4(冷轧)">Grade 4:纯钛(材料供应商:Zapp)</option>
                            <option value="Grade 4A">Grade 4A:纯钛(未知材料供应商)</option>
                            <option value="TC4">TC4(Ti-6Al-4V):钛合金</option>
                            <option value="TC4-ELI">TC4 ELI(Ti-6Al-4V ELI):钛合金</option>
                            <option value="S45500">S45500:不锈钢</option>
                            <option value="S46500">S46500:不锈钢</option>
                            <option value="1RK91">1RK91:不锈钢</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">测试人</label>
                        <input type="text" id="testMember-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                            placeholder="输入测试人">
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">测试时间</label>
                        <input type="date" id="testTime-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">结果状态<span class="text-red-600">
                                *</span></label>
                        <select id="resultStatus-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200">
                            <option value="">请选择</option>
                            <option value="通过">通过</option>
                            <option value="未通过">未通过</option>
                            <option value="待确认">待确认</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">测试结果<span class="text-red-600">
                                *</span></label>
                        <input type="text" id="result-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                            placeholder="输入测试结果">
                    </div>
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-1">通过标准</label>
                        <input type="text" id="resultStrandard-modal"
                            class="w-full p-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-200"
                            placeholder="输入通过标准：如'200N 500W次'">
                    </div>
                </div>

                <div id="remark-content" class="space-x-2 space-y-2 flex-grow p-6">
                    <label class="block text-lg font-medium text-gray-700 mb-1">备注信息</label>
                    <textarea id="modal-remarks" name="modal-remarks" rows="3"
                        class="block border border-gray-300 w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                        placeholder="请输入备注信息..."></textarea>
                </div>
                <div id="file-content" class="space-x-2 space-y-2 flex-grow mb-4 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <label class="block text-lg font-medium text-gray-700 mb-1 ml-4">关联文件<span class="text-red-600">
                                *</span></label>
                    </div>
                    <!-- 关联文件checkbox列表 -->
                    <div class="">
                        <ul id="fileList" class="space-y-2">
                            <!-- 文件项将通过JavaScript动态添加 -->
                        </ul>
                    </div>
                </div>
            </div>
            <!-- 按钮 -->
            <div class="justify-end sticky bottom-0 border-t border-gray-100 px-3 pt-4 mb-2">
                <div class="flex space-x-2">
                    <button id="submit-button"
                        class="flex-1 bg-primary hover:bg-primary/90 text-sm text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-paper-plane mr-2"></i>
                        保存并提交
                    </button>
                    <button id="pass-button"
                        class="hidden flex-1 bg-green-600 hover:bg-green-600/90 text-sm text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-check mr-2"></i>
                        审核：通过
                    </button>
                    <button id="not-pass-button"
                        class="hidden flex-1 bg-red-100 hover:bg-red-200 text-sm text-red-600 font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-times mr-2"></i>
                        <p id="notPassBtn-txt">审核：不通过</p>
                    </button>
                    <button id="delete-button"
                        class="hidden flex-1 bg-red-100 hover:bg-red-200 text-sm text-red-600 font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-trash-alt mr-2"></i>
                        <p id="notPassBtn-txt">删除</p>
                    </button>
                    <button id="cancel-button"
                        class="flex-1 bg-gray-100 hover:bg-gray-200 text-sm text-gray-600 font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-cancel mr-2"></i>
                        取消
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- JavaScript -->
    <!-- 初始化粒子效果 -->
    <script>
        particlesJS.load('particles-js', '../../particlesConfig.json', function () {
        });
    </script>
    <script src="../JavaScript/verifyGroup.js"></script>
    <!-- 获取测试数据 -->
    <script src="../JavaScript/getTestData.js" type="module"></script>
    <script src="../JavaScript/addTestData.js"></script>
    <script src="../JavaScript/query.js"></script>
    <script src="../JavaScript/showNotification.js"></script>
    <script src="../JavaScript/api.js"></script>
    <script src="../javaScript/getFileData.js"></script>

    <!-- 筛选条件区域隐藏 -->
    <script>
        const filterDrawer = document.getElementById('filter-drawer');
        const filterIcon = document.getElementById('filter-drawer-icon');
        const conditionTerm = document.getElementById('condition-term')
        const conditionBtns = document.getElementById('condition-btns')

        filterDrawer.addEventListener('click', () => {
            conditionTerm.classList.toggle('hidden')
            conditionBtns.classList.toggle('hidden')
            if(conditionTerm.classList.contains('hidden')){
                filterIcon.classList.replace('fa-eye', 'fa-eye-slash')
            } else {
                filterIcon.classList.replace('fa-eye-slash', 'fa-eye')
            }
        })

    </script>

    <!-- 筛选表隐藏列处理 -->
    <script>
        const columnToggleBtn = document.getElementById('column-toggle-btn');
        const toggleContainer = document.getElementById('column-toggle-container');
        const eyeIcon = document.getElementById('column-toggle-icon')
        const tableHeaders = table.querySelectorAll('thead th');
        // 为每一列创建复选框并添加到容器中
        // 预设：隐藏项目
        const hiddenItems = ['测试标准', '材料', '测试时间', '测试人']
        tableHeaders.forEach(header => {
            if (header.dataset.column && header.dataset.column !== '操作') { // 跳过操作列
                const columnName = header.dataset.column;
                const checkbox = document.createElement('label');
                const isChecked = hiddenItems.includes(columnName) ? 'unChecked' : 'checked' ;
                checkbox.className = 'block flex items-center mb-1.5';
                checkbox.innerHTML = `
                    <input type="checkbox" class="checkbox-primary rounded column-toggle-checkbox mr-1" data-column="${columnName}" ${isChecked}>
                    <span class="text-sm text-gray-700 mr-4">${columnName}</span>
                `;
                toggleContainer.appendChild(checkbox);
            }
        });

        columnToggleBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // 阻止事件冒泡，避免点击容器外关闭
            toggleContainer.classList.toggle('hidden');
            
            // 切换按钮图标和文本
            if (toggleContainer.classList.contains('hidden')) {
                eyeIcon.className = 'fa fa-chevron-down mr-1';
            } else {
                eyeIcon.className = 'fa fa-chevron-up mr-1';
            }
        })

        document.querySelectorAll('.column-toggle-checkbox').forEach(checkbox => {
            const columnName = checkbox.dataset.column;
            toggleColumnVisibility(columnName, checkbox.checked);
            checkbox.addEventListener('change', function() {
                const columnName = this.dataset.column;
                toggleColumnVisibility(columnName, this.checked);
            });
        });

        // 切换列可见性的函数
        function toggleColumnVisibility(columnName, isVisible) {
            // 处理表头
            const header = Array.from(tableHeaders).find(h => h.dataset.column === columnName);
            if (header) {
                header.style.display = isVisible ? '' : 'none';
            }
            
            // 处理表体
            const tableBody = document.getElementById('test-data-body');
            if (tableBody) {
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const columnCell = Array.from(cells).find(cell => cell.dataset.column === columnName);
                    if (columnCell) {
                        columnCell.style.display = isVisible ? '' : 'none';
                    }
                });
            }

            // 处理筛选条件框
            const conditionTerm = document.getElementById('condition-term');
            const div = conditionTerm.querySelector(`[data-column="${columnName}"]`)
            if(div!==null && isVisible) {
                const eyeIcon = div.querySelector('i')
                eyeIcon.classList.add('hidden')
            }
            if(div!==null && !isVisible) {
                const eyeIcon = div.querySelector('i')
                eyeIcon.classList.remove('hidden')
            }

        }
    </script>

</body>

</html>